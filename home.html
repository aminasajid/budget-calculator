<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MyBudgetTracker</title>
    <!-- BOOTSTRAP -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <!-- CHART.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- CSS -->
    <link rel="stylesheet" href="./css/style.css" />
    <!-- GOOGLE FONTS -->
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <!-- FONT AWESOME -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- FAVICON -->
    <link
      rel="shortcut icon"
      href="https://cdn-icons-png.flaticon.com/128/2488/2488980.png"
      type="image/x-icon"
    />
  </head>

  <body>
    <!-- header -->
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container-fluid ms-3">
        <a class="navbar-brand" href="#">
          <i
            class="fa-regular fa-user"
            style="color: #487973; margin-right: 10px"
          ></i>
          Welcome
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            <li class="nav-item d-block text-end">
              <button
                class="btn btn-outline-danger me-3"
                id="logoutBtn"
                onclick="logout()"
              >
                Logout
              </button>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- main -->
    <div class="container">
      <div class="row">
        <h3 class="text-center pt-5 pb-3">My Budget Tracker</h3>
        <span class="line"></span>
      </div>
    </div>

    <!-- card -->
    <div class="container mt-5">
      <h4 class="text-center" id="balance">Current Balance: 0.00</h4>
    </div>

    <div class="container mt-5 section-1">
      <div class="row">
        <div class="col-md-6 p-5">
          <h4 class="text-center mb-5">Enter Your Income</h4>
          <input
            id="incomeType"
            type="text"
            placeholder="Enter Income Type"
            class="form-control mb-4"
          />
          <input
            id="incomeAmount"
            type="text"
            placeholder="Enter Amount"
            class="form-control mb-4"
          />
          <div class="d-grid justify-content-center">
            <button
              class="btn addbtn text-light p-2"
              id="addIncomeBtn"
              onclick="addIncome()"
            >
              ADD INCOME
            </button>
          </div>
        </div>
        <div class="col-md-6 p-5">
          <h4 class="text-center mb-5">Enter Your Expenses</h4>
          <input
            id="expenseType"
            type="text"
            placeholder="Enter Expense Type"
            class="form-control mb-4"
          />
          <input
            id="expenseAmount"
            type="text"
            placeholder="Enter Amount"
            class="form-control mb-4"
          />
          <div class="d-grid justify-content-center">
            <button
              class="btn addbtn text-light p-2"
              id="addExpenseBtn"
              onclick="addExpense()"
            >
              ADD EXPENSE
            </button>
          </div>
        </div>
      </div>
      <!-- clear button -->
      <div class="row">
        <div class="d-grid justify-content-center">
          <button
            class="btn addbtn text-light p-2 mb-5"
            id="clearAllBtn"
            onclick="clearAll()"
          >
            CLEAR ALL
          </button>
        </div>
      </div>
    </div>

    <!-- section-2 -->
    <div class="container">
      <div class="row">
        <h3 class="text-center pt-5">Income and Expense Details</h3>
        <span class="line"></span>
        <div class="row">
          <div class="col-md-6 d-grid justify-content-center">
            <h4 class="mt-5 text-center">INCOME</h4>
            <table class="border border-1 border-dark">
              <thead>
                <tr>
                  <th class="border border-1 border-dark">Type</th>
                  <th class="border border-1 border-dark">Amount</th>
                  <th class="border border-1 border-dark">Balance</th>
                  <th class="border border-1 border-dark">Date and Time</th>
                </tr>
              </thead>
              <tbody id="incomeResult"></tbody>
            </table>
          </div>
          <div class="col-md-6 d-grid justify-content-center">
            <h4 class="mt-5 text-center">EXPENSE</h4>
            <table class="border border-1 border-dark">
              <thead>
                <tr>
                  <th class="border border-1 border-dark">Type</th>
                  <th class="border border-1 border-dark">Amount</th>
                  <th class="border border-1 border-dark">Balance</th>
                  <th class="border border-1 border-dark">Date and Time</th>
                </tr>
              </thead>
              <tbody id="expenseResult"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <!-- pie chart container -->
    <div class="container mt-4">
      <h2 class="text-pink text-center">Expense Pie-Chart</h2>
      <div class="d-flex justify-content-center mt-5">
        <button
          class="btn addbtn text-light p-2 mb-5"
          id="displayChartBtn"
          onclick="displayChart()"
        >
          Show Pie-Chart
        </button>
      </div>
      <div class="text-center">
        <canvas id="oldPieChart" width="700" height="400"></canvas>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Load balance from session storage
        let balance = parseFloat(sessionStorage.getItem("balance")) || 0;
        document.getElementById(
          "balance"
        ).innerText = `Current Balance: ${balance.toFixed(2)}`;

        // Load income and expense data from session storage
        loadRecords("income");
        loadRecords("expense");
      });

      function addIncome() {
        const incomeType = document.getElementById("incomeType").value;
        const incomeAmount = parseFloat(
          document.getElementById("incomeAmount").value
        );

        if (incomeType && !isNaN(incomeAmount) && incomeAmount > 0) {
          let balance = parseFloat(sessionStorage.getItem("balance")) || 0;
          balance += incomeAmount;
          sessionStorage.setItem("balance", balance);
          document.getElementById(
            "balance"
          ).innerText = `Current Balance: ${balance.toFixed(2)}`;

          let incomeRecords =
            JSON.parse(sessionStorage.getItem("incomeRecords")) || [];
          incomeRecords.push({
            type: incomeType,
            amount: incomeAmount,
            balance: balance,
            date: new Date().toLocaleString(),
          });
          sessionStorage.setItem(
            "incomeRecords",
            JSON.stringify(incomeRecords)
          );

          loadRecords("income");
          document.getElementById("incomeType").value = "";
          document.getElementById("incomeAmount").value = "";
        } else {
          alert("Please enter a valid income type and amount.");
        }
      }

      function addExpense() {
        const expenseType = document.getElementById("expenseType").value;
        const expenseAmount = parseFloat(
          document.getElementById("expenseAmount").value
        );

        if (expenseType && !isNaN(expenseAmount) && expenseAmount > 0) {
          let balance = parseFloat(sessionStorage.getItem("balance")) || 0;
          balance -= expenseAmount;
          sessionStorage.setItem("balance", balance);
          document.getElementById(
            "balance"
          ).innerText = `Current Balance: ${balance.toFixed(2)}`;

          let expenseRecords =
            JSON.parse(sessionStorage.getItem("expenseRecords")) || [];
          expenseRecords.push({
            type: expenseType,
            amount: expenseAmount,
            balance: balance,
            date: new Date().toLocaleString(),
          });
          sessionStorage.setItem(
            "expenseRecords",
            JSON.stringify(expenseRecords)
          );

          loadRecords("expense");
          document.getElementById("expenseType").value = "";
          document.getElementById("expenseAmount").value = "";
        } else {
          alert("Please enter a valid expense type and amount.");
        }
      }

      function loadRecords(type) {
        const records =
          JSON.parse(sessionStorage.getItem(`${type}Records`)) || [];
        const tbody = document.getElementById(`${type}Result`);
        tbody.innerHTML = "";

        records.forEach((record) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
          <td class="border border-1 border-dark">${record.type}</td>
          <td class="border border-1 border-dark">${record.amount.toFixed(
            2
          )}</td>
          <td class="border border-1 border-dark">${record.balance.toFixed(
            2
          )}</td>
          <td class="border border-1 border-dark">${record.date}</td>
        `;
          tbody.appendChild(tr);
        });
      }

      function clearAll() {
        sessionStorage.removeItem("balance");
        sessionStorage.removeItem("incomeRecords");
        sessionStorage.removeItem("expenseRecords");

        document.getElementById("balance").innerText = "Current Balance: 0.00";
        document.getElementById("incomeResult").innerHTML = "";
        document.getElementById("expenseResult").innerHTML = "";
      }

      function displayChart() {
        const expenseRecords =
          JSON.parse(sessionStorage.getItem("expenseRecords")) || [];

        const expenseData = expenseRecords.reduce((acc, record) => {
          acc[record.type] = (acc[record.type] || 0) + record.amount;
          return acc;
        }, {});

        const ctx = document.getElementById("oldPieChart").getContext("2d");
        new Chart(ctx, {
          type: "pie",
          data: {
            labels: Object.keys(expenseData),
            datasets: [
              {
                label: "Expense Distribution",
                data: Object.values(expenseData),
                backgroundColor: [
                  "rgba(255, 99, 132, 0.2)",
                  "rgba(54, 162, 235, 0.2)",
                  "rgba(255, 206, 86, 0.2)",
                  "rgba(75, 192, 192, 0.2)",
                  "rgba(153, 102, 255, 0.2)",
                  "rgba(255, 159, 64, 0.2)",
                ],
                borderColor: [
                  "rgba(255, 99, 132, 1)",
                  "rgba(54, 162, 235, 1)",
                  "rgba(255, 206, 86, 1)",
                  "rgba(75, 192, 192, 1)",
                  "rgba(153, 102, 255, 1)",
                  "rgba(255, 159, 64, 1)",
                ],
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "top",
              },
              tooltip: {
                callbacks: {
                  label: function (tooltipItem) {
                    return `${tooltipItem.label}: ${tooltipItem.raw.toFixed(
                      2
                    )}`;
                  },
                },
              },
            },
          },
        });
      }

      function logout() {
        window.location.href = "index.html"; // Replace with your actual login page URL
      }
    </script>
  </body>
</html>
